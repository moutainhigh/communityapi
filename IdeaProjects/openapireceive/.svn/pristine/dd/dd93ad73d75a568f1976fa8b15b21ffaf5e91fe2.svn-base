<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="net.okdi.api.dao.MemberContactMapper" >
  <resultMap id="BaseResultMap" type="net.okdi.api.entity.MemberContact" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Oct 28 13:08:38 CST 2014.
    -->
    <id column="id" property="id" jdbcType="BIGINT" />
    <result column="create_user_id" property="createUserId" jdbcType="BIGINT" />
    <result column="contact_name" property="contactName" jdbcType="VARCHAR" />
    <result column="gender" property="gender" jdbcType="SMALLINT" />
    <result column="contact_phone" property="contactPhone" jdbcType="VARCHAR" />
    <result column="contact_address_id" property="contactAddressId" jdbcType="BIGINT" />
    <result column="contact_detaile_display" property="contactDetaileDisplay" jdbcType="VARCHAR" />
    <result column="contact_detailed_address" property="contactDetailedAddress" jdbcType="VARCHAR" />
    <result column="data_mode" property="dataMode" jdbcType="SMALLINT" />
    <result column="name_abbr" property="nameAbbr" jdbcType="VARCHAR" />
    <result column="create_time" property="createTime" jdbcType="TIMESTAMP" />
    <result column="birthday" property="birthday" jdbcType="TIMESTAMP" />
    <result column="remark" property="remark" jdbcType="VARCHAR" />
    <result column="cas_member_id" property="casMemberId" jdbcType="BIGINT" />
    <result column="erp_customer_id" property="erpCustomerId" jdbcType="BIGINT" />
  </resultMap>
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Oct 28 13:08:38 CST 2014.
    -->
    id,
    create_user_id, 
    contact_name, gender, 
    contact_phone, 
    contact_address_id, 
    contact_detaile_display, 
    contact_detailed_address, 
    data_mode, 
    name_abbr, 
    create_time, 
    birthday, 
    remark, 
    cas_member_id, 
    erp_customer_id
  </sql>
 
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Long" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Oct 28 13:08:38 CST 2014.
    -->
    delete from member_contact
    where id = #{id,jdbcType=BIGINT}
  </delete>
  <insert id="insert" parameterType="net.okdi.api.entity.MemberContact" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Oct 28 13:08:38 CST 2014.
    -->
    insert into member_contact (id, create_user_id, contact_name, 
      gender, contact_phone, contact_address_id, 
      contact_detaile_display, contact_detailed_address, 
      data_mode, name_abbr, create_time, 
      birthday, remark, cas_member_id, 
      erp_customer_id)
    values (#{id,jdbcType=BIGINT}, #{createUserId,jdbcType=BIGINT}, #{contactName,jdbcType=VARCHAR}, 
      #{gender,jdbcType=SMALLINT}, #{contactPhone,jdbcType=VARCHAR}, #{contactAddressId,jdbcType=BIGINT}, 
      #{contactDetaileDisplay,jdbcType=VARCHAR}, #{contactDetailedAddress,jdbcType=VARCHAR}, 
      #{dataMode,jdbcType=SMALLINT}, #{nameAbbr,jdbcType=VARCHAR}, #{createTime,jdbcType=TIMESTAMP}, 
      #{birthday,jdbcType=TIMESTAMP}, #{remark,jdbcType=VARCHAR}, #{casMemberId,jdbcType=BIGINT}, 
      #{erpCustomerId,jdbcType=BIGINT})
  </insert>
   
   <select id="getMemberContactListByPage" parameterType="java.util.Map" resultType="java.util.Map">
   select 
    DISTINCT
	    a.id as id ,
	    a.create_user_id as createUserId, 
	    a.contact_name as contactName,
	    a.gender as gender, 
	    a.contact_phone as contactPhone, 
	    a.contact_address_id as contactAddressId, 
	     IFNULL(a.contact_detaile_display ,' ')as contactDetaileDisplay, 
	    IFNULL(a.contact_detailed_address ,' ' )as contactDetailedAddress, 
	    a.data_mode as dataMode, 
	    a.name_abbr as nameAbbr, 
	    a.create_time as createTime, 
	    a.birthday as birthday, 
	    a.remark as remark, 
	    a.cas_member_id as casMemberId, 
	    a.erp_customer_id as erpCustomerId,
	    ' ' as level6AddressId
	    from member_contact a 
	    left join member_contact_tag_relation b
	    on a.id = b.contact_id
	    where 1=1 
	    and a.create_user_id =#{memberId}
	    <if test="groupId!=null">
	     and b.tag_id = #{groupId}
	    </if>
	    <if test="pageSize!=null">
	    LIMIT #{startNum},#{pageSize}
	    </if>
   </select>
   <select id="getMemberContactInfo" parameterType="java.lang.Long" resultType="net.okdi.api.entity.MemberContact">
     select
        a.id as id ,
	    a.create_user_id as createUserId, 
	    a.contact_name as contactName,
	    a.gender as gender, 
	    ifnull(a.contact_phone,' ') as contactPhone, 
	    a.contact_address_id as contactAddressId, 
	    a.contact_detaile_display as contactDetaileDisplay, 
	    a.contact_detailed_address as contactDetailedAddress, 
	    a.data_mode as dataMode, 
	    a.name_abbr as nameAbbr, 
	    a.create_time as createTime, 
	    a.birthday as birthday, 
	    a.remark as remark, 
	    a.cas_member_id as casMemberId, 
	    a.erp_customer_id as erpCustomerId
	   <!--   b.tag_id as tagId-->
	    from member_contact a 
	   <!-- left join member_contact_tag_relation b
	     on a.id = b.contact_id-->
	    where id = #{contactId}
   </select>
   <select id="ifExist" parameterType="java.util.Map" resultType="java.util.Map">
   select id from member_contact where create_user_id = #{memberId} and contact_phone = #{contactName}
   </select>
</mapper>